# Code Review ‚Äî MCP JavaFX Debug ‚úÖ

–î–∞—Ç–∞: 2026-01-07

–ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:
- –ü—Ä–æ–≤–µ–¥–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–µ–≤—å—é –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º: KISS, —á–∏—Ç–∞–µ–º–æ—Å—Ç—å, DRY, SOLID, Separation of Concerns, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ UI/–ª–æ–≥–∏–∫–∏.
- –ù–∏–∂–µ ‚Äî —Å–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º, –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –∏ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞.

---

## –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞
**–£—Ä–æ–≤–µ–Ω—å –∫–æ–¥–∞:** –•–æ—Ä–æ—à–∏–π –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π —É—Ä–æ–≤–µ–Ω—å ‚Äî –∞–∫–∫—É—Ä–∞—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–æ–≤ (api, transport, mcp, core, model, util), –ø–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ –∏ —Ä–∞–±–æ—á–∏–µ e2e-—Ç–µ—Å—Ç—ã.

**–ì–ª–∞–≤–Ω–æ–π –ø—Ä–æ–±–ª–µ–º–æ–π** —è–≤–ª—è–µ—Ç—Å—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (MCP tools) –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è NodeRef (UID/path). –≠—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å –∏ –±—ã—Å—Ç—Ä–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è.

---

## –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1) DRY / KISS: –¥–≤–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—É–ª–æ–≤ (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏) ‚ö†Ô∏è

- –ì–¥–µ: `McpToolAdapter.java` –∏ `McpToolRegistry.java`.
- –ü—Ä–æ–±–ª–µ–º–∞: –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π –∫–æ–¥ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ input, executeGetSnapshot/Query/GetNode/Perform/Screenshot, parseRef/parsePredicate, successResponse/errorResponse –∏ createMapper ‚Äî –Ω–∞—Ä—É—à–µ–Ω–∏–µ DRY –∏ —Ä–∏—Å–∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–≤–∞–Ω–∏—è.
- –£–ª—É—á—à–µ–Ω–∏–µ: –≤—ã–¥–µ–ª–∏—Ç—å –µ–¥–∏–Ω—ã–π —Å–µ—Ä–≤–∏—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä `UiToolsService`) —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ (getSnapshot/query/getNode/perform/screenshot). Adapter –∏ Registry –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–æ–Ω–∫–∏–º–∏ –æ–±–≤—è–∑–∫–∞–º–∏.

–ü—Ä–∏–º–µ—Ä –∏–¥–µ–∏:
```java
public final class UiToolsService {
  public UiSnapshot getSnapshot(SnapshotRequest req) { ... }
  public QueryResult query(QueryRequest req) { ... }
  // ...
}
```


2) SOLID / SRP: `McpToolAdapter` –¥–µ–ª–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ üß©

- –ì–¥–µ: `McpToolAdapter.java`.
- –ü—Ä–æ–±–ª–µ–º–∞: —Å–º–µ—à–∏–≤–∞—é—Ç—Å—è schema/registration + –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ + —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–ª–æ–≥–∏–∫–∞ –æ—à–∏–±–æ–∫.
- –£–ª—É—á—à–µ–Ω–∏–µ: —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ `ToolSchemas` (schema/description), `UiToolsService` (–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ), `McpToolAdapter` (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è SDK ‚Üî handlers).


3) NodeRef/UID: —Ä–∞—Å—Å–∏–Ω—Ö–æ–∂–¥–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ (Snapshotter vs Query) üîó

- –ì–¥–µ: `SceneGraphSnapshotter.java` –∏ `NodeQueryService.java`.
- –ü—Ä–æ–±–ª–µ–º–∞: UID –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ snapshotter (—á–µ—Ä–µ–∑ —Å–≤–æ–π—Å—Ç–≤–∞ node), –∞ query –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω –¥–æ snapshot ‚Äî uid –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
- –£–ª—É—á—à–µ–Ω–∏–µ: –≤—ã–Ω–µ—Å—Ç–∏ `NodeRefService` (–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç uid, —Å—Ç—Ä–æ–∏—Ç path) –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑ snapshoter –∏ query.

–ü—Ä–∏–º–µ—Ä:
```java
public final class NodeRefService {
  public NodeRef forNode(Node node, int stageIndex) { /* —Å–æ–∑–¥–∞–µ—Ç/–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç uid –∏ path */ }
}
```


4) –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å `typeText` (ActionExecutor) ‚Äî –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ üî§

- –ì–¥–µ: `ActionExecutor.typeText`.
- –ü—Ä–æ–±–ª–µ–º–∞: –ø–µ—Ä–µ–≤–æ–¥ —Å–∏–º–≤–æ–ª–æ–≤ –≤ KeyCode –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–±–µ–ª—ã, –∑–Ω–∞–∫–∏ –∏ Unicode; —Ä–æ–±–∞—Å—Ç–Ω–æ—Å—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ä–∞—Å–∫–ª–∞–¥–∫–∞—Ö –ø–ª–æ—Ö–∞—è.
- –£–ª—É—á—à–µ–Ω–∏–µ: —Å–Ω–∞—á–∞–ª–∞ –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –∑–∞–ø–∏—Å–∞—Ç—å —á–µ—Ä–µ–∑ API `TextInputControl.insertText` –µ—Å–ª–∏ —Ñ–æ–∫—É—Å ‚Äî —ç—Ç–æ `TextInputControl`; Robot ‚Äî –∫–∞–∫ fallback.

–ü—Ä–∏–º–µ—Ä:
```java
if (focusOwner instanceof TextInputControl input) {
  input.insertText(input.getCaretPosition(), text);
  return ActionResult.success("typeText");
}
```


5) Predicate `enabled` —É—Å–ª–æ–≤–∏–µ —á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ—è–≤–Ω–æ ‚Äî —É–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ üßæ

- –ì–¥–µ: `NodeQueryService.matchesPredicate`.
- –£–ª—É—á—à–µ–Ω–∏–µ: —è–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ `nodeEnabled = !node.isDisabled(); if (nodeEnabled != pred.enabled()) return false;`.


6) –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ RequestLoggingFilter ‚Äî —Ä–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö/–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ üîí

- –ì–¥–µ: `RequestLoggingFilter.java`.
- –ü—Ä–æ–±–ª–µ–º–∞: body MCP-–∑–∞–ø—Ä–æ—Å–æ–≤ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ/—Å–µ–∫—Ä–µ—Ç—ã.
- –£–ª—É—á—à–µ–Ω–∏–µ: –¥–µ–ª–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ body –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥ (`mcp.http.logRequests`) –∏/–∏–ª–∏ –º–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è.


7) Lifecycle –≤ –¥–µ–º–æ: –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è handle –ø—Ä–∏ stop üßπ

- –ì–¥–µ: `DemoApp.java`.
- –£–ª—É—á—à–µ–Ω–∏–µ: —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å `McpJavafxHandle handle` –∏ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –≤ `stop()`.

–ü—Ä–∏–º–µ—Ä:
```java
@Override public void stop() {
  if (handle != null) handle.close();
}
```


8) Default config: `enabled=true` ‚Äî –º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π default ‚öôÔ∏è

- –ì–¥–µ: `McpJavafxConfig.Builder`.
- –ü—Ä–∏—á–∏–Ω–∞: –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä ‚Äî —ç—Ç–æ –Ω–µ –≤—Å–µ–≥–¥–∞ –∂–µ–ª–∞–µ–º–æ.
- –£–ª—É—á—à–µ–Ω–∏–µ: default `enabled=false`, —è–≤–Ω–æ –≤–∫–ª—é—á–∞—Ç—å —á–µ—Ä–µ–∑ system props/demo.


9) Security: –ø—Ä–æ–≤–µ—Ä–∫–∞ Origin —á–µ—Ä–µ–∑ startsWith —É—è–∑–≤–∏–º–∞ üõ°Ô∏è

- –ì–¥–µ: `AuthorizationFilter.isAllowedOrigin`.
- –ü—Ä–æ–±–ª–µ–º–∞: `origin.startsWith("http://localhost")` –ø—Ä–æ–ø—É—Å—Ç–∏—Ç `http://localhost.evil.com`.
- –£–ª—É—á—à–µ–Ω–∏–µ: –ø–∞—Ä—Å–∏—Ç—å Origin –∫–∞–∫ URI –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å host —Ç–æ—á–Ω–æ (`localhost`, `127.0.0.1`, `::1`).

–ü—Ä–∏–º–µ—Ä:
```java
var uri = URI.create(origin);
var host = uri.getHost();
return ("localhost".equalsIgnoreCase(host) || "127.0.0.1".equals(host));
```


10) –§–∏–ª—å—Ç—Ä—ã –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ —á–∏—Ç–∞—é—Ç body (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å/–ø–∞–º—è—Ç—å) üß†

- –ì–¥–µ: `RequestLoggingFilter`, `RequestSanitizingFilter`, `LoggingSetLevelFilter`.
- –ü—Ä–æ–±–ª–µ–º–∞: –∫–∞–∂–¥—ã–π —Ñ–∏–ª—å—Ç—Ä –¥–µ–ª–∞–µ—Ç `readAllBytes()` –∏ —Å–æ–∑–¥–∞–µ—Ç wrapper.
- –£–ª—É—á—à–µ–Ω–∏–µ: –µ–¥–∏–Ω—ã–π `CachedBodyFilter` –¥–ª—è —á—Ç–µ–Ω–∏—è body –æ–¥–∏–Ω —Ä–∞–∑ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ –∞—Ç—Ä–∏–±—É—Ç –∑–∞–ø—Ä–æ—Å–∞.


11) Timeout handling: `FxTimeoutException` –º–∞–ø–∏—Ç—Å—è –≤ INTERNAL ‚Äî –Ω—É–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚è±Ô∏è

- –ì–¥–µ: Fx.exec / tool layers.
- –£–ª—É—á—à–µ–Ω–∏–µ: –ª–æ–≤–∏—Ç—å `FxTimeoutException` –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `MCP_UI_TIMEOUT` (–≤ error code), –¥–æ–±–∞–≤–∏–≤ `details` —Å `timeoutMs`.


12) –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è userData: –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å jackson –∏ —Ä–µ–∫—É—Ä—Å–∏–µ–π üß©

- –ì–¥–µ: `SceneGraphSnapshotter.captureFxProperties`.
- –ü—Ä–æ–±–ª–µ–º–∞: `userData` –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±—ã–º –æ–±—ä–µ–∫—Ç–æ–º –∏ –ª–æ–º–∞—Ç—å —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é.
- –£–ª—É—á—à–µ–Ω–∏–µ: —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä `userData.toString()` / –∫–ª–∞—Å—Å + toString, –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ —Ç–∏–ø–∞–º.


13) Robust parsing of path: –ø–∞—Ä—Å–∏–Ω–≥ `stages[0]` –±–µ–∑ try/catch –Ω–µ–Ω–∞–¥—ë–∂–µ–Ω üß∞

- –ì–¥–µ: `NodeQueryService.findByPath`.
- –£–ª—É—á—à–µ–Ω–∏–µ: –º—è–≥–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –∏–Ω–¥–µ–∫—Å–æ–≤ (try/catch), –∏ –Ω–∞ –æ—à–∏–±–∫—É ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `null` ‚Üí `NODE_NOT_FOUND`/`STALE_REF` –≤–º–µ—Å—Ç–æ INTERNAL.


14) Snapshot performance: heavy work done fully on FX thread ‚Äî —Ä–∏—Å–∫ –ø–æ–¥–≤–µ—Å–∏—Ç—å UI üö¶

- –ì–¥–µ: `SceneGraphSnapshotter.captureOnFxThread`.
- –£–ª—É—á—à–µ–Ω–∏–µ: –¥–≤—É—Ö—Ñ–∞–∑–Ω—ã–π –ø–æ–¥—Ö–æ–¥: (1) –Ω–∞ FX –ø–æ–ª—É—á–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (bounds/text/ref), (2) –≤–Ω–µ FX ‚Äî –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞/–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (summary, trimming, safe serialization). –¢–∞–∫–∂–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –æ–±—Ö–æ–¥, –∞ –Ω–µ –≥–ª—É–±–æ–∫—É—é —Ä–µ–∫—É—Ä—Å–∏—é.


15) –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `McpLogger`: –ø–µ—á–∞—Ç—å –≤ stdout –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫ üì£

- –ì–¥–µ: `McpLogger`.
- –£–ª—É—á—à–µ–Ω–∏–µ: —Å—Ç–∞–≤–∏—Ç—å –≤–∫–ª—é—á–µ–Ω–∏–µ –ø–µ—á–∞—Ç–∏ –≤ stdout/stderr –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥ –∏–ª–∏ —Ç–æ–ª—å–∫–æ –ø–∏—Å–∞—Ç—å –≤ `java.util.logging` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.


16) Adapter –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É SDK: —Å–ª–∞–±–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è üîó

- –ì–¥–µ: `McpToolAdapter.registerTools(McpStatelessSyncServer)`.
- –£–ª—É—á—à–µ–Ω–∏–µ: –≤–≤–µ—Å—Ç–∏ —Ç–æ–Ω–∫–∏–π –ª–æ–∫–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `ToolRegistrar` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –æ–±—â–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç.


17) –¢–µ—Å—Ç—ã: —Ö–æ—Ä–æ—à–∏–π coverage, –Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç –Ω–∞ `typeText` –ø–æ—Å–ª–µ —Ñ–∏–∫—Å–∞ üß™

- –ì–¥–µ: `McpClientStreamableHttpE2eTest`
- –£–ª—É—á—à–µ–Ω–∏–µ: –ø–æ–∫—Ä—ã—Ç—å typeText –∏ edge-cases (unicode, modifiers) –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è `typeText`.


---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã (–ø—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–π backlog)

- P0 (–≤—ã—Å–æ–∫–∏–π):
  - –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—É–ª–æ–≤: —Å–æ–∑–¥–∞—Ç—å `UiToolsService` –∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å `McpToolAdapter`/`McpToolRegistry` –Ω–∞ –Ω–µ–≥–æ.
  - –í—ã–Ω–µ—Å—Ç–∏ `NodeRefService` (—É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è UID/path).
  - –ò—Å–ø—Ä–∞–≤–∏—Ç—å `typeText` (API-first –≤–≤–æ–¥), –∏ –ø–æ–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–æ–º.
  - –û–±—Ä–∞–±–æ—Ç–∫—É FxTimeoutException ‚Üí `MCP_UI_TIMEOUT`.

- P1 (—Å—Ä–µ–¥–Ω–∏–π):
  - –í–≤–µ—Å—Ç–∏ `CachedBodyFilter` –∏ —Å–¥–µ–ª–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ body –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º.
  - –£–ª—É—á—à–∏—Ç—å `AuthorizationFilter.isAllowedOrigin`.
  - –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è `userData`.

- P2 (–Ω–∏–∑–∫–∏–π):
  - –†–∞–∑–¥–µ–ª–∏—Ç—å –ª–æ–≥–≥–µ—Ä—ã (System.out –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
  - –í—ã–Ω–µ—Å—Ç–∏ schema –≤ `ToolSchemas` —Ñ–∞–π–ª—ã.
  - –£–ª—É—á—à–∏—Ç—å –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é `ToolRegistrar`.

---

## –ü—Ä–∏–º–µ—Ä–Ω—ã–π –ø–ª–∞–Ω –∏–∑–º–µ–Ω–µ–Ω–∏–π (–º–∞–ª—ã–π —Ä–∏—Å–∫, –±—ã—Å—Ç—Ä–∞—è –≤—ã–≥–æ–¥–∞)
1. –°–æ–∑–¥–∞—Ç—å `UiToolsService` –∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç—É–¥–∞ `execute*` –º–µ—Ç–æ–¥—ã, –æ—Å—Ç–∞–≤–∏–≤ thin adapter/registry.
2. –î–æ–±–∞–≤–∏—Ç—å `NodeRefService` –∏ –∑–∞–º–µ–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤ snapshot & query.
3. –ò—Å–ø—Ä–∞–≤–∏—Ç—å `typeText` –∏ –¥–æ–±–∞–≤–∏—Ç—å unit+e2e —Ç–µ—Å—Ç—ã.
4. –õ–æ–≤–∏—Ç—å `FxTimeoutException` –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `MCP_UI_TIMEOUT`.

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
- –ö–æ–¥ –≤ –ø—Ä–æ–µ–∫—Ç–µ –ø–æ–Ω—è—Ç–Ω—ã–π –∏ —Ä–∞–±–æ—á–∏–π; –µ—Å—Ç—å —Ö–æ—Ä–æ—à–∞—è –±–∞–∑–∞ —Ç–µ—Å—Ç–æ–≤ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è –ø—Ä–æ—Å–ª–æ–π–∫–∞.
- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å ‚Äî –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω UID/path ‚Äî –ª–µ–≥–∫–æ —Ä–µ—à–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –Ω–µ–±–æ–ª—å—à–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏.
- –ü–æ—Å–ª–µ P0-—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–µ–∫—Ç —Å—Ç–∞–Ω–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ —Ä–∞—Å—à–∏—Ä—è—Ç—å.

---

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –º–æ–≥—É:
- –≤—ã–ø–æ–ª–Ω–∏—Ç—å P0-—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –≤ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ (–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ, —Å —Ç–µ—Å—Ç–∞–º–∏), –ª–∏–±–æ
- –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å PR-—à–∏—Ñ—Ä–æ–≤–∫—É —Å –Ω–∞–±—Ä–æ—Å–∫–∞–º–∏ –ø–∞—Ç—á–µ–π –∏ –ø–æ–∫—Ä—ã—Ç–∏—è–º–∏ —Ç–µ—Å—Ç–∞–º–∏.

> –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω –∫–∞–∫ `docs/CODE_REVIEW.md` –≤ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞. 

